<?php defined('BASEPATH') OR exit('No direct script access allowed');

class Menu extends SAM_Controller 
{
	public function __construct()
	{
		parent::__construct();
		$this->load->model('M_menu');

        $this->is_login = $this->verify_login();
	}

	public function lists()
	{
		// Get Plain Request
		$res = json_decode(file_get_contents('php://input'));

		if(SECURED)
			// Get Secured Request
			$res = json_decode($this->encryption->sam_decrypt(file_get_contents('php://input')));

		if($this->is_login){
			$lists = [];
			// Get List
			$data_menu = $this->M_menu->getAll();
			// Set Menu and Submenu
			foreach ($data_menu as $value) {
				if($value->parent == 0)
				{
					$lists[(int)$value->sequence]['parent'] = $value;
				}else{
					$lists[(int)$value->sequence]['sub'][] = $value;
				}
			}
			// Set the Response
			$this->response_code = 200;
			$this->response['status'] = TRUE;
			$this->response['data'] = $lists;
		}

		// Run the Application
		$this->run(SECURED);
	}

}